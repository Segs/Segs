link_directories(${ThirdParty_Install_Dir}/lib)

include(ExternalProject_CEREAL.cmake)
include(ExternalProject_ACE.cmake)
if(MINGW) # ERICEDIT: If the OS is Windows:
    add_custom_target( # ERICEDIT: Add a target that depends on authserver.
        libace ALL
        DEPENDS ${EXECUTABLE_OUTPUT_PATH}/authserver.exe
        )
    add_custom_command( # ERICEDIT: Copy over libACE.dll to the output directory.
        TARGET libace
        POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${ace_LIBRARY_SHARED} ${EXECUTABLE_OUTPUT_PATH}
        )
endif()
if(BUILD_COX_MAP_VIEWER)
    include(ExternalProject_Lutefisk3D.cmake)
endif()
########################################################################################
# Optional components
########################################################################################

if(ENABLE_SCRIPTING_ENGINE)
    include(ExternalProject_LUA.cmake)
    include(ExternalProject_SOL2.cmake)
endif()

if(ENABLE_TESTS)
    enable_testing()
    ExternalProject_Add(
        GMOCK_BUILD
        DOWNLOAD_DIR ${PROJECT_SOURCE_DIR}/3rd_party/gmock
        URL http://googlemock.googlecode.com/files/gmock-1.6.0.zip
        UPDATE_COMMAND ""
        PATCH_COMMAND patch -N -t -p1 < ../gmock.patch
        SOURCE_DIR ${PROJECT_SOURCE_DIR}/3rd_party/gmock
        INSTALL_DIR ${PROJECT_SOURCE_DIR}/3rd_party/
        CMAKE_ARGS -DCMAKE_INSTALL_PREFIX:PATH=<INSTALL_DIR>
    )
    set(GTest_LIBRARIES gtest gtest_main ${CMAKE_THREAD_LIBS_INIT})
endif()


#
# OpenSSL is missing on Windows.
#
if(MINGW)
    message(STATUS "    Installing system-libraries: OpenSSL DLLs.")
    add_custom_target(
        openssl ALL
        DEPENDS ${EXECUTABLE_OUTPUT_PATH}/SEGSAdmin.exe
    )
    add_custom_command(
        TARGET openssl
        POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${CMAKE_CURRENT_SOURCE_DIR}/openssl/libeay32.dll ${EXECUTABLE_OUTPUT_PATH}
    )
    add_custom_command(
        TARGET openssl
        POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${CMAKE_CURRENT_SOURCE_DIR}/openssl/ssleay32.dll ${EXECUTABLE_OUTPUT_PATH}
    )
endif(MINGW)
